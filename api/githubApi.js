import axios from 'axios';
const GITHUB_GRAPHQL_URL = 'https://api.github.com/graphql';

export const callGithubApi = async (packageName) => {
    const query = `
      query {
        securityVulnerabilities(ecosystem: NPM, first: 100, package: "${packageName}") {
          nodes {
            severity
            advisory {
              summary
            }
            package {
              name
              ecosystem
            }
            vulnerableVersionRange
            firstPatchedVersion {
              identifier
            }
          }
        }
      }
    `;
  
    try {
      const response = await axios.post(
        GITHUB_GRAPHQL_URL,
        { query: query },
        { headers: { Authorization: `Bearer ${process.env.GITHUB_ACCESS_TOKEN}` } }
      );
      return response;
    } catch (error) {
        console.error(`Error fetching vulnerabilities for ${packageName}:`, error);
        return null;
    }
};