import { ECOSYSTEMS, PROVIDER } from "../consts.js";

const parseNpmFileContent = (dependencyFile) => {
    return JSON.parse(dependencyFile).dependencies || {};
};

const ECOSYSTEM_TO_FILE_PARSER = {
    [ECOSYSTEMS.npm] : parseNpmFileContent,
};

export const parseFileContent = (ecosystem, dependencyFile) => {
    return ECOSYSTEM_TO_FILE_PARSER[ecosystem](dependencyFile);
};

const githubResponseParser = (node) => {
    const { severity, advisory,firstPatchedVersion, vulnerableVersionRange } = node;
    return {
        name: node.package.name, //package is a reserved word, cannot destruct
        severity: severity,
        summary: advisory.summary,
        firstPatchedVersion: firstPatchedVersion ? firstPatchedVersion.identifier : null,
        vulnerableVersionRange: vulnerableVersionRange,
      };
};

export const PROVIDER_RESPONSE_PARSER = {
    [PROVIDER.githubApi] : githubResponseParser,
}

